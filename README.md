# Dify智能体批量测试工具

一个专门用于Dify平台智能体批量测试的自动化工具。支持通过Excel文件管理测试用例，对智能体回答进行相似度评估和结果分析。

## 功能特点

- 专门对接Dify平台的智能体API接口
- 支持Excel格式的测试用例批量管理
- 自动化执行API测试并收集响应
- 多线程并发请求支持，显著提升测试效率
- 多种评估方式：
  - 传统文本相似度评估（余弦相似度、Jaccard相似度）
  - BERT深度学习模型语义相似度评估（可选）
  - 智能评估系统（通过评估智能体）
- 详细的测试报告和分析统计
- 友好的图形用户界面
- 完整的中文支持

## 系统要求

- Python 3.6 或更高版本
- Windows、macOS 或 Linux 操作系统
- 可访问的Dify平台API服务

## 安装步骤

1. **克隆或下载本仓库**

2. **安装依赖库**

   使用以下命令安装必要的依赖库:
   ```
   pip install -r requirements.txt
   ```

   如果需要使用BERT模型进行高级语义相似度评估，需安装额外的依赖:
   ```
   pip install torch transformers scikit-learn
   ```

3. **启动应用程序**

   Windows用户可以直接运行`start_test_tool.bat`或`start_simple.bat`启动程序。
   
   也可以通过命令行启动:
   ```
   python gui_test.py
   ```

## 使用说明

### 基本测试流程

1. **准备测试用例**
   - 创建Excel文件，必须包含以下两列:
     - `测试问题`: 要发送给Dify智能体的问题
     - `测试答案`: 预期的智能体回答
   - 将文件保存为.xlsx格式

2. **配置测试**
   - 运行程序，点击"浏览..."选择测试用例文件
   - 输入Dify智能体的API Token
   - 设置请求间隔时间（建议不少于1秒，避免频繁请求）
   - 设置并发线程数（建议3-10个，避免请求过于频繁）
   - 设置输出文件路径（可选）

3. **执行测试**
   - 点击"开始测试"按钮
   - 程序会使用多线程并发处理测试请求
   - 可以随时通过"停止测试"按钮暂停测试
   - 实时显示每个测试用例的执行状态

4. **分析结果**
   - 测试完成后，可以选择分析方式：
     - 传统相似度分析：本地分析，速度快
     - 智能评估：通过评估智能体进行打分
   - 分析结果将保存为Excel文件

### 高级设置说明

1. **并发线程数**
   - 默认值：3个线程
   - 建议范围：3-10个线程
   - 注意事项：
     - 线程数越多，测试速度越快
     - 需要考虑服务器承载能力
     - 建议结合请求间隔时间调整

2. **请求间隔时间**
   - 默认值：3秒
   - 作用：控制每个线程发送请求的间隔
   - 建议：根据服务器响应情况适当调整

### 结果分析功能

系统支持两种分析方式:

1. **传统相似度分析**
   - 使用余弦相似度和Jaccard相似度的加权平均进行评估
   - 本地计算，无需额外API调用
   - 适合快速了解结果概况

2. **智能评估系统**
   - 通过Dify平台的专业评估智能体进行打分
   - 评分标准（0-5分制）：
     - 相关性（40%）：关键词匹配、语义一致性、主题深度
     - 正确性（30%）：事实准确性、逻辑结构
     - 详细程度（20%）：要点覆盖率、案例支撑
     - 拓展价值（10%）：场景建议、趋势分析
   - 评分参考：
     - 5分：答案相关且完全正确，回答详实，有拓展建议和前瞻性思考
     - 4分：答案相关且完全正确，回答详实
     - 3分：答案非常相关但回答简略
     - 2分：答案有点相关但回答简略
     - 1分：答案基本不相关
     - 0分：系统错误
   - 需要在Dify平台部署评估智能体（模板文件：`评估.yml`）

### BERT模型支持

如果安装了`transformers`和`torch`库，程序会自动启用BERT模型进行更准确的语义相似度评估：

- 能够理解语义上相似但表达不同的文本
- 专门优化支持中文语义理解
- 评估结果更接近人类判断

第一次运行时会自动下载BERT模型，可能需要一些时间。

## 常见问题

### Q: 程序启动时出现编码错误
A: 尝试使用`start_simple.bat`启动，或确保系统已启用UTF-8支持。

### Q: "未安装transformers或torch库"警告
A: 这是正常的，程序将使用传统方法进行相似度评估。如需使用BERT模型，请安装相关依赖。

### Q: 如何批量分析已有的测试结果?
A: 点击"分析结果"按钮，选择之前生成的测试结果文件。

### Q: 请求总是失败怎么办？
A: 请检查：
1. Dify平台API服务是否正常运行
2. API Token是否正确
3. 网络连接是否正常
4. 请求间隔是否设置合理

## 文件结构

- `gui_test.py`: 主程序文件
- `start_test_tool.bat`: Windows启动脚本
- `start_simple.bat`: 简化版Windows启动脚本
- `requirements.txt`: 依赖库列表
- `评估.yml`: 评估智能体的Dify配置模板
- `output/`: 测试结果输出目录
- `analysis_results/`: 分析报告输出目录

## 更新日志

### 版本 1.2
- 新增多线程并发请求功能
- 添加线程数和请求间隔控制
- 优化请求处理逻辑
- 改进错误处理机制

### 版本 1.1
- 集成BERT模型支持
- 添加智能评估系统
- 优化UI界面
- 修复编码问题

### 版本 1.0
- 基本的Dify接口测试功能
- 传统相似度评估
- Excel报告生成

## 联系方式

如有问题或建议，请通过以下方式联系：

- 提交GitHub Issue
- 邮箱：[1286214601@qq.com]
- 微信：[XT18703806809]

## 致谢

感谢所有贡献者的支持！ 
